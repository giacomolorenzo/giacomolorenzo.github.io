<!doctype html><html lang=it><meta charset=utf-8><meta name=generator content="Hugo 0.82.1"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>Estraiamo i dati da Spotify con Python&nbsp;&ndash;&nbsp;Giacomo Lorenzo programming blog</title><link rel=stylesheet href=/css/core.min.690fe4f1938174bb288772c3865bf1b132321696c242e03a38276a8b11ab25e4f51b6305df1bb0e78a66d13d46f39d85.css integrity=sha384-aQ/k8ZOBdLsoh3LDhlvxsTIyFpbCQuA6OCdqixGrJeT1G2MF3xuw54pm0T1G852F><meta name=twitter:card content="summary"><meta name=twitter:title content="Estraiamo i dati da Spotify con Python"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><span class="site name">Giacomo Lorenzo programming blog</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/categories/>Categorie</a><a class="nav item" href=/tags/>Tag</a><a class="nav item" href=/about/>About</a><a class="nav item" href=https://gohugo%2eio/ target=_blank rel="noopener noreferrer">Hugo</a></nav></div></span></div><div class="site slogan"><span class=title>100% JavaScript-free</span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">Estraiamo i dati da Spotify con Python</h1></section><article class="article markdown-body"><h2 id=mini-guida-per-estrarre-i-dati-delle-ultime-canzoni-ascoltate-da-spotify>Mini guida per estrarre i dati delle ultime canzoni ascoltate da spotify</h2><p>Innanzitutto sarà necessario installare python se non lo si ha nel proprio ambiente installiamolo da qui, <a href=[https://link]%28https://www.python.org/downloads/%29>Python</a></p><h2 id=attrezziamoci>Attrezziamoci</h2><h3 id=dipendenze-python>Dipendenze Python</h3><p>Sarà necessario installare i <a href=https://raw.githubusercontent.com/giacomolorenzo/spotify-etl-data/main/requirement.txt target=_blank rel="noopener noreferrer">Requirement.txt</a>
tramite il comando:</p><p><code>pip install requirements.txt</code></p><h3 id=token-spotify>Token Spotify</h3><p>Adesso sarà necessario reperire un token dalla developer console di spotify <a href="https://developer.spotify.com/console/get-recently-played/?limit=&after=&before=" target=_blank rel="noopener noreferrer">Spotify Console</a>
Una volta ottenuto il token possiamo cominciare a scrivere il nostro file python</p><p>cominciamo importanto le librerie e dichiarando le costanti:</p><pre><code>import sqlalchemy
import pandas as pd 
from sqlalchemy.orm import sessionmaker
import requests
import urllib
import json
from datetime import datetime
import datetime
import sqlite3
import os
from dotenv import load_dotenv
load_dotenv(os.path.join(&quot;./&quot;, '.env'))
DATABASE_LOCATION = &quot;sqlite:///my_played_tracks.sqlite&quot;
TOKEN= os.getenv(&quot;TOKEN_SPOTIFY&quot;)
</code></pre><p><strong>Creiamo un file .env</strong> che ci servirà per ottenere il valore del token di spotify qui un esempio:</p><pre><code>export TOKEN_SPOTIFY=&lt;SPOTIFY_TOKEN&gt;
</code></pre><h3 id=interroghiamo-spotify>Interroghiamo spotify</h3><p>Definiamo un if in modo da eseguire queste azioni solo come main e poi definiamo un oggetto headers in cui all&rsquo;interno definiamo tutto il necessario per avere una risposta dalle API di spotify</p><pre><code>if __name__ == &quot;__main__&quot;:
    headers = {
        &quot;Accept&quot;: &quot;application/json&quot;,
        &quot;Content-Type&quot;: &quot;application/json&quot;,
        &quot;Authorization&quot;: &quot;Bearer {token}&quot;.format(token=TOKEN)
    }
</code></pre><p>ok adesso sarà necessario capire quale API di Spotify vogliamo usare nel nostro caso useremo <strong>Recentlyplayed</strong> che ci permetterà di vedere le ultime canzoni che abbiamo ascoltato negli ultimi X giorni, ma vediamo come fare.</p><p>ok adesso definiamo 3 variabili per gestire il tempo in modo da passarlo alle api di spotify nel modo corretto:</p><pre><code>    today = datetime.datetime.now()
    yesterday = today - datetime.timedelta(days=60)
    yesterday_unix_timestamp = int(yesterday.timestamp()) * 1000
</code></pre><p><strong>today</strong> rappresenta la data attuale.</p><p><strong>yesterday</strong> la data dalla quale vogliamo partire nel nostro caso gli ultimi 60 giorni.</p><p><strong>yesterday_unix_timestamp</strong> è la rappresentazione della data in formato timestamp che è quello che viene
accettato dalle API di Spotify.</p><h3 id=facciamo-la-nostra-prima-richiesta>Facciamo la nostra prima richiesta</h3><pre><code>r = requests.get(&quot;https://api.spotify.com/v1/me/player/recently-played?after={time}&quot;.format(time=yesterday_unix_timestamp),headers=headers) 
</code></pre><p>Andiamo ad analizzare la richiesta per effettuarla utilizzeremo <a href=https://pypi.org/project/requests/ target=_blank rel="noopener noreferrer">Request</a></p><p>Come primo parametro l&rsquo;url come secondo parametro l&rsquo;headers che abbiamo precedentemente creato.</p><p>questo è un esempio di risposta:</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;items&#34;</span> <span class=p>:</span> <span class=p>[</span> <span class=p>{</span>
    <span class=nt>&#34;track&#34;</span> <span class=p>:</span> <span class=p>{</span>
      <span class=nt>&#34;album&#34;</span> <span class=p>:</span> <span class=p>{</span>
        <span class=nt>&#34;album_type&#34;</span> <span class=p>:</span> <span class=s2>&#34;single&#34;</span><span class=p>,</span>
        <span class=nt>&#34;artists&#34;</span> <span class=p>:</span> <span class=p>[</span> <span class=p>{</span>
          <span class=nt>&#34;external_urls&#34;</span> <span class=p>:</span> <span class=p>{</span>
            <span class=nt>&#34;spotify&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://open.spotify.com/artist/6Tu0luJL7EoFv1RsHZP30p&#34;</span>
          <span class=p>},</span>
          <span class=nt>&#34;href&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://api.spotify.com/v1/artists/6Tu0luJL7EoFv1RsHZP30p&#34;</span><span class=p>,</span>
          <span class=nt>&#34;id&#34;</span> <span class=p>:</span> <span class=s2>&#34;6Tu0luJL7EoFv1RsHZP30p&#34;</span><span class=p>,</span>
          <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=s2>&#34;Ranji&#34;</span><span class=p>,</span>
          <span class=nt>&#34;type&#34;</span> <span class=p>:</span> <span class=s2>&#34;artist&#34;</span><span class=p>,</span>
          <span class=nt>&#34;uri&#34;</span> <span class=p>:</span> <span class=s2>&#34;spotify:artist:6Tu0luJL7EoFv1RsHZP30p&#34;</span>
        <span class=p>},</span> <span class=p>{</span>
          <span class=nt>&#34;external_urls&#34;</span> <span class=p>:</span> <span class=p>{</span>
            <span class=nt>&#34;spotify&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://open.spotify.com/artist/6ZJDt01Lh0XOPMMJbUMcUi&#34;</span>
          <span class=p>},</span>
          <span class=nt>&#34;href&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://api.spotify.com/v1/artists/6ZJDt01Lh0XOPMMJbUMcUi&#34;</span><span class=p>,</span>
          <span class=nt>&#34;id&#34;</span> <span class=p>:</span> <span class=s2>&#34;6ZJDt01Lh0XOPMMJbUMcUi&#34;</span><span class=p>,</span>
          <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=s2>&#34;Ghost Rider&#34;</span><span class=p>,</span>
          <span class=nt>&#34;type&#34;</span> <span class=p>:</span> <span class=s2>&#34;artist&#34;</span><span class=p>,</span>
          <span class=nt>&#34;uri&#34;</span> <span class=p>:</span> <span class=s2>&#34;spotify:artist:6ZJDt01Lh0XOPMMJbUMcUi&#34;</span>
        <span class=p>}</span> <span class=p>],</span>
        <span class=nt>&#34;available_markets&#34;</span> <span class=p>:</span> <span class=p>[</span> <span class=s2>&#34;AD&#34;</span><span class=p>,</span> <span class=s2>&#34;AE&#34;</span><span class=p>,</span> <span class=s2>&#34;AG&#34;</span><span class=p>,</span> <span class=s2>&#34;AL&#34;</span><span class=p>,</span> <span class=s2>&#34;AM&#34;</span><span class=p>,</span> <span class=s2>&#34;AO&#34;</span><span class=p>,</span> <span class=s2>&#34;AR&#34;</span><span class=p>,</span> <span class=s2>&#34;AT&#34;</span><span class=p>,</span> <span class=s2>&#34;AU&#34;</span><span class=p>,</span> <span class=s2>&#34;AZ&#34;</span><span class=p>,</span> <span class=s2>&#34;BA&#34;</span><span class=p>,</span> <span class=s2>&#34;BB&#34;</span><span class=p>,</span> <span class=s2>&#34;BD&#34;</span><span class=p>,</span> <span class=s2>&#34;BE&#34;</span><span class=p>,</span> <span class=s2>&#34;BF&#34;</span><span class=p>,</span> <span class=s2>&#34;BG&#34;</span><span class=p>,</span> <span class=s2>&#34;BH&#34;</span><span class=p>,</span> <span class=s2>&#34;BI&#34;</span><span class=p>,</span> <span class=s2>&#34;BJ&#34;</span><span class=p>,</span> <span class=s2>&#34;BN&#34;</span><span class=p>,</span> <span class=s2>&#34;BO&#34;</span><span class=p>,</span> <span class=s2>&#34;BR&#34;</span><span class=p>,</span> <span class=s2>&#34;BS&#34;</span><span class=p>,</span> <span class=s2>&#34;BT&#34;</span><span class=p>,</span> <span class=s2>&#34;BW&#34;</span><span class=p>,</span> <span class=s2>&#34;BY&#34;</span><span class=p>,</span> <span class=s2>&#34;BZ&#34;</span><span class=p>,</span> <span class=s2>&#34;CA&#34;</span><span class=p>,</span> <span class=s2>&#34;CH&#34;</span><span class=p>,</span> <span class=s2>&#34;CI&#34;</span><span class=p>,</span> <span class=s2>&#34;CL&#34;</span><span class=p>,</span> <span class=s2>&#34;CM&#34;</span><span class=p>,</span> <span class=s2>&#34;CO&#34;</span><span class=p>,</span> <span class=s2>&#34;CR&#34;</span><span class=p>,</span> <span class=s2>&#34;CV&#34;</span><span class=p>,</span> <span class=s2>&#34;CW&#34;</span><span class=p>,</span> <span class=s2>&#34;CY&#34;</span><span class=p>,</span> <span class=s2>&#34;CZ&#34;</span><span class=p>,</span> <span class=s2>&#34;DE&#34;</span><span class=p>,</span> <span class=s2>&#34;DJ&#34;</span><span class=p>,</span> <span class=s2>&#34;DK&#34;</span><span class=p>,</span> <span class=s2>&#34;DM&#34;</span><span class=p>,</span> <span class=s2>&#34;DO&#34;</span><span class=p>,</span> <span class=s2>&#34;DZ&#34;</span><span class=p>,</span> <span class=s2>&#34;EC&#34;</span><span class=p>,</span> <span class=s2>&#34;EE&#34;</span><span class=p>,</span> <span class=s2>&#34;EG&#34;</span><span class=p>,</span> <span class=s2>&#34;ES&#34;</span><span class=p>,</span> <span class=s2>&#34;FI&#34;</span><span class=p>,</span> <span class=s2>&#34;FJ&#34;</span><span class=p>,</span> <span class=s2>&#34;FM&#34;</span><span class=p>,</span> <span class=s2>&#34;FR&#34;</span><span class=p>,</span> <span class=s2>&#34;GA&#34;</span><span class=p>,</span> <span class=s2>&#34;GB&#34;</span><span class=p>,</span> <span class=s2>&#34;GD&#34;</span><span class=p>,</span> <span class=s2>&#34;GE&#34;</span><span class=p>,</span> <span class=s2>&#34;GH&#34;</span><span class=p>,</span> <span class=s2>&#34;GM&#34;</span><span class=p>,</span> <span class=s2>&#34;GN&#34;</span><span class=p>,</span> <span class=s2>&#34;GQ&#34;</span><span class=p>,</span> <span class=s2>&#34;GR&#34;</span><span class=p>,</span> <span class=s2>&#34;GT&#34;</span><span class=p>,</span> <span class=s2>&#34;GW&#34;</span><span class=p>,</span> <span class=s2>&#34;GY&#34;</span><span class=p>,</span> <span class=s2>&#34;HK&#34;</span><span class=p>,</span> <span class=s2>&#34;HN&#34;</span><span class=p>,</span> <span class=s2>&#34;HR&#34;</span><span class=p>,</span> <span class=s2>&#34;HT&#34;</span><span class=p>,</span> <span class=s2>&#34;HU&#34;</span><span class=p>,</span> <span class=s2>&#34;ID&#34;</span><span class=p>,</span> <span class=s2>&#34;IE&#34;</span><span class=p>,</span> <span class=s2>&#34;IL&#34;</span><span class=p>,</span> <span class=s2>&#34;IN&#34;</span><span class=p>,</span> <span class=s2>&#34;IS&#34;</span><span class=p>,</span> <span class=s2>&#34;IT&#34;</span><span class=p>,</span> <span class=s2>&#34;JM&#34;</span><span class=p>,</span> <span class=s2>&#34;JO&#34;</span><span class=p>,</span> <span class=s2>&#34;JP&#34;</span><span class=p>,</span> <span class=s2>&#34;KE&#34;</span><span class=p>,</span> <span class=s2>&#34;KG&#34;</span><span class=p>,</span> <span class=s2>&#34;KH&#34;</span><span class=p>,</span> <span class=s2>&#34;KI&#34;</span><span class=p>,</span> <span class=s2>&#34;KM&#34;</span><span class=p>,</span> <span class=s2>&#34;KN&#34;</span><span class=p>,</span> <span class=s2>&#34;KR&#34;</span><span class=p>,</span> <span class=s2>&#34;KW&#34;</span><span class=p>,</span> <span class=s2>&#34;KZ&#34;</span><span class=p>,</span> <span class=s2>&#34;LA&#34;</span><span class=p>,</span> <span class=s2>&#34;LB&#34;</span><span class=p>,</span> <span class=s2>&#34;LC&#34;</span><span class=p>,</span> <span class=s2>&#34;LI&#34;</span><span class=p>,</span> <span class=s2>&#34;LK&#34;</span><span class=p>,</span> <span class=s2>&#34;LR&#34;</span><span class=p>,</span> <span class=s2>&#34;LS&#34;</span><span class=p>,</span> <span class=s2>&#34;LT&#34;</span><span class=p>,</span> <span class=s2>&#34;LU&#34;</span><span class=p>,</span> <span class=s2>&#34;LV&#34;</span><span class=p>,</span> <span class=s2>&#34;MA&#34;</span><span class=p>,</span> <span class=s2>&#34;MC&#34;</span><span class=p>,</span> <span class=s2>&#34;MD&#34;</span><span class=p>,</span> <span class=s2>&#34;ME&#34;</span><span class=p>,</span> <span class=s2>&#34;MG&#34;</span><span class=p>,</span> <span class=s2>&#34;MH&#34;</span><span class=p>,</span> <span class=s2>&#34;MK&#34;</span><span class=p>,</span> <span class=s2>&#34;ML&#34;</span><span class=p>,</span> <span class=s2>&#34;MN&#34;</span><span class=p>,</span> <span class=s2>&#34;MO&#34;</span><span class=p>,</span> <span class=s2>&#34;MR&#34;</span><span class=p>,</span> <span class=s2>&#34;MT&#34;</span><span class=p>,</span> <span class=s2>&#34;MU&#34;</span><span class=p>,</span> <span class=s2>&#34;MV&#34;</span><span class=p>,</span> <span class=s2>&#34;MW&#34;</span><span class=p>,</span> <span class=s2>&#34;MX&#34;</span><span class=p>,</span> <span class=s2>&#34;MY&#34;</span><span class=p>,</span> <span class=s2>&#34;MZ&#34;</span><span class=p>,</span> <span class=s2>&#34;NA&#34;</span><span class=p>,</span> <span class=s2>&#34;NE&#34;</span><span class=p>,</span> <span class=s2>&#34;NG&#34;</span><span class=p>,</span> <span class=s2>&#34;NI&#34;</span><span class=p>,</span> <span class=s2>&#34;NL&#34;</span><span class=p>,</span> <span class=s2>&#34;NO&#34;</span><span class=p>,</span> <span class=s2>&#34;NP&#34;</span><span class=p>,</span> <span class=s2>&#34;NR&#34;</span><span class=p>,</span> <span class=s2>&#34;NZ&#34;</span><span class=p>,</span> <span class=s2>&#34;OM&#34;</span><span class=p>,</span> <span class=s2>&#34;PA&#34;</span><span class=p>,</span> <span class=s2>&#34;PE&#34;</span><span class=p>,</span> <span class=s2>&#34;PG&#34;</span><span class=p>,</span> <span class=s2>&#34;PH&#34;</span><span class=p>,</span> <span class=s2>&#34;PK&#34;</span><span class=p>,</span> <span class=s2>&#34;PL&#34;</span><span class=p>,</span> <span class=s2>&#34;PS&#34;</span><span class=p>,</span> <span class=s2>&#34;PT&#34;</span><span class=p>,</span> <span class=s2>&#34;PW&#34;</span><span class=p>,</span> <span class=s2>&#34;PY&#34;</span><span class=p>,</span> <span class=s2>&#34;QA&#34;</span><span class=p>,</span> <span class=s2>&#34;RO&#34;</span><span class=p>,</span> <span class=s2>&#34;RS&#34;</span><span class=p>,</span> <span class=s2>&#34;RU&#34;</span><span class=p>,</span> <span class=s2>&#34;RW&#34;</span><span class=p>,</span> <span class=s2>&#34;SA&#34;</span><span class=p>,</span> <span class=s2>&#34;SB&#34;</span><span class=p>,</span> <span class=s2>&#34;SC&#34;</span><span class=p>,</span> <span class=s2>&#34;SE&#34;</span><span class=p>,</span> <span class=s2>&#34;SG&#34;</span><span class=p>,</span> <span class=s2>&#34;SI&#34;</span><span class=p>,</span> <span class=s2>&#34;SK&#34;</span><span class=p>,</span> <span class=s2>&#34;SL&#34;</span><span class=p>,</span> <span class=s2>&#34;SM&#34;</span><span class=p>,</span> <span class=s2>&#34;SN&#34;</span><span class=p>,</span> <span class=s2>&#34;SR&#34;</span><span class=p>,</span> <span class=s2>&#34;ST&#34;</span><span class=p>,</span> <span class=s2>&#34;SV&#34;</span><span class=p>,</span> <span class=s2>&#34;SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;TD&#34;</span><span class=p>,</span> <span class=s2>&#34;TG&#34;</span><span class=p>,</span> <span class=s2>&#34;TH&#34;</span><span class=p>,</span> <span class=s2>&#34;TL&#34;</span><span class=p>,</span> <span class=s2>&#34;TN&#34;</span><span class=p>,</span> <span class=s2>&#34;TO&#34;</span><span class=p>,</span> <span class=s2>&#34;TR&#34;</span><span class=p>,</span> <span class=s2>&#34;TT&#34;</span><span class=p>,</span> <span class=s2>&#34;TV&#34;</span><span class=p>,</span> <span class=s2>&#34;TW&#34;</span><span class=p>,</span> <span class=s2>&#34;TZ&#34;</span><span class=p>,</span> <span class=s2>&#34;UA&#34;</span><span class=p>,</span> <span class=s2>&#34;UG&#34;</span><span class=p>,</span> <span class=s2>&#34;US&#34;</span><span class=p>,</span> <span class=s2>&#34;UY&#34;</span><span class=p>,</span> <span class=s2>&#34;UZ&#34;</span><span class=p>,</span> <span class=s2>&#34;VC&#34;</span><span class=p>,</span> <span class=s2>&#34;VN&#34;</span><span class=p>,</span> <span class=s2>&#34;VU&#34;</span><span class=p>,</span> <span class=s2>&#34;WS&#34;</span><span class=p>,</span> <span class=s2>&#34;XK&#34;</span><span class=p>,</span> <span class=s2>&#34;ZA&#34;</span><span class=p>,</span> <span class=s2>&#34;ZM&#34;</span><span class=p>,</span> <span class=s2>&#34;ZW&#34;</span> <span class=p>],</span>
        <span class=nt>&#34;external_urls&#34;</span> <span class=p>:</span> <span class=p>{</span>
          <span class=nt>&#34;spotify&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://open.spotify.com/album/2uKiw3sMzeXdim7hmBp9oF&#34;</span>
        <span class=p>},</span>
        <span class=nt>&#34;href&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://api.spotify.com/v1/albums/2uKiw3sMzeXdim7hmBp9oF&#34;</span><span class=p>,</span>
        <span class=nt>&#34;id&#34;</span> <span class=p>:</span> <span class=s2>&#34;2uKiw3sMzeXdim7hmBp9oF&#34;</span><span class=p>,</span>
        <span class=nt>&#34;images&#34;</span> <span class=p>:</span> <span class=p>[</span> <span class=p>{</span>
          <span class=nt>&#34;height&#34;</span> <span class=p>:</span> <span class=mi>640</span><span class=p>,</span>
          <span class=nt>&#34;url&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://i.scdn.co/image/ab67616d0000b273af959e67cc49b1de59e00ffe&#34;</span><span class=p>,</span>
          <span class=nt>&#34;width&#34;</span> <span class=p>:</span> <span class=mi>640</span>
        <span class=p>},</span> <span class=p>{</span>
          <span class=nt>&#34;height&#34;</span> <span class=p>:</span> <span class=mi>300</span><span class=p>,</span>
          <span class=nt>&#34;url&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://i.scdn.co/image/ab67616d00001e02af959e67cc49b1de59e00ffe&#34;</span><span class=p>,</span>
          <span class=nt>&#34;width&#34;</span> <span class=p>:</span> <span class=mi>300</span>
        <span class=p>},</span> <span class=p>{</span>
          <span class=nt>&#34;height&#34;</span> <span class=p>:</span> <span class=mi>64</span><span class=p>,</span>
          <span class=nt>&#34;url&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://i.scdn.co/image/ab67616d00004851af959e67cc49b1de59e00ffe&#34;</span><span class=p>,</span>
          <span class=nt>&#34;width&#34;</span> <span class=p>:</span> <span class=mi>64</span>
        <span class=p>}</span> <span class=p>],</span>
        <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=s2>&#34;Can&#39;t Sleep (Radio Version)&#34;</span><span class=p>,</span>
        <span class=nt>&#34;release_date&#34;</span> <span class=p>:</span> <span class=s2>&#34;2020-06-26&#34;</span><span class=p>,</span>
        <span class=nt>&#34;release_date_precision&#34;</span> <span class=p>:</span> <span class=s2>&#34;day&#34;</span><span class=p>,</span>
        <span class=nt>&#34;total_tracks&#34;</span> <span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
        <span class=nt>&#34;type&#34;</span> <span class=p>:</span> <span class=s2>&#34;album&#34;</span><span class=p>,</span>
        <span class=nt>&#34;uri&#34;</span> <span class=p>:</span> <span class=s2>&#34;spotify:album:2uKiw3sMzeXdim7hmBp9oF&#34;</span>
      <span class=p>},</span>
      <span class=nt>&#34;artists&#34;</span> <span class=p>:</span> <span class=p>[</span> <span class=p>{</span>
        <span class=nt>&#34;external_urls&#34;</span> <span class=p>:</span> <span class=p>{</span>
          <span class=nt>&#34;spotify&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://open.spotify.com/artist/6Tu0luJL7EoFv1RsHZP30p&#34;</span>
        <span class=p>},</span>
        <span class=nt>&#34;href&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://api.spotify.com/v1/artists/6Tu0luJL7EoFv1RsHZP30p&#34;</span><span class=p>,</span>
        <span class=nt>&#34;id&#34;</span> <span class=p>:</span> <span class=s2>&#34;6Tu0luJL7EoFv1RsHZP30p&#34;</span><span class=p>,</span>
        <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=s2>&#34;Ranji&#34;</span><span class=p>,</span>
        <span class=nt>&#34;type&#34;</span> <span class=p>:</span> <span class=s2>&#34;artist&#34;</span><span class=p>,</span>
        <span class=nt>&#34;uri&#34;</span> <span class=p>:</span> <span class=s2>&#34;spotify:artist:6Tu0luJL7EoFv1RsHZP30p&#34;</span>
      <span class=p>},</span> <span class=p>{</span>
        <span class=nt>&#34;external_urls&#34;</span> <span class=p>:</span> <span class=p>{</span>
          <span class=nt>&#34;spotify&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://open.spotify.com/artist/6ZJDt01Lh0XOPMMJbUMcUi&#34;</span>
        <span class=p>},</span>
        <span class=nt>&#34;href&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://api.spotify.com/v1/artists/6ZJDt01Lh0XOPMMJbUMcUi&#34;</span><span class=p>,</span>
        <span class=nt>&#34;id&#34;</span> <span class=p>:</span> <span class=s2>&#34;6ZJDt01Lh0XOPMMJbUMcUi&#34;</span><span class=p>,</span>
        <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=s2>&#34;Ghost Rider&#34;</span><span class=p>,</span>
        <span class=nt>&#34;type&#34;</span> <span class=p>:</span> <span class=s2>&#34;artist&#34;</span><span class=p>,</span>
        <span class=nt>&#34;uri&#34;</span> <span class=p>:</span> <span class=s2>&#34;spotify:artist:6ZJDt01Lh0XOPMMJbUMcUi&#34;</span>
      <span class=p>}</span> <span class=p>],</span>
      <span class=nt>&#34;available_markets&#34;</span> <span class=p>:</span> <span class=p>[</span> <span class=s2>&#34;AD&#34;</span><span class=p>,</span> <span class=s2>&#34;AE&#34;</span><span class=p>,</span> <span class=s2>&#34;AG&#34;</span><span class=p>,</span> <span class=s2>&#34;AL&#34;</span><span class=p>,</span> <span class=s2>&#34;AM&#34;</span><span class=p>,</span> <span class=s2>&#34;AO&#34;</span><span class=p>,</span> <span class=s2>&#34;AR&#34;</span><span class=p>,</span> <span class=s2>&#34;AT&#34;</span><span class=p>,</span> <span class=s2>&#34;AU&#34;</span><span class=p>,</span> <span class=s2>&#34;AZ&#34;</span><span class=p>,</span> <span class=s2>&#34;BA&#34;</span><span class=p>,</span> <span class=s2>&#34;BB&#34;</span><span class=p>,</span> <span class=s2>&#34;BD&#34;</span><span class=p>,</span> <span class=s2>&#34;BE&#34;</span><span class=p>,</span> <span class=s2>&#34;BF&#34;</span><span class=p>,</span> <span class=s2>&#34;BG&#34;</span><span class=p>,</span> <span class=s2>&#34;BH&#34;</span><span class=p>,</span> <span class=s2>&#34;BI&#34;</span><span class=p>,</span> <span class=s2>&#34;BJ&#34;</span><span class=p>,</span> <span class=s2>&#34;BN&#34;</span><span class=p>,</span> <span class=s2>&#34;BO&#34;</span><span class=p>,</span> <span class=s2>&#34;BR&#34;</span><span class=p>,</span> <span class=s2>&#34;BS&#34;</span><span class=p>,</span> <span class=s2>&#34;BT&#34;</span><span class=p>,</span> <span class=s2>&#34;BW&#34;</span><span class=p>,</span> <span class=s2>&#34;BY&#34;</span><span class=p>,</span> <span class=s2>&#34;BZ&#34;</span><span class=p>,</span> <span class=s2>&#34;CA&#34;</span><span class=p>,</span> <span class=s2>&#34;CH&#34;</span><span class=p>,</span> <span class=s2>&#34;CI&#34;</span><span class=p>,</span> <span class=s2>&#34;CL&#34;</span><span class=p>,</span> <span class=s2>&#34;CM&#34;</span><span class=p>,</span> <span class=s2>&#34;CO&#34;</span><span class=p>,</span> <span class=s2>&#34;CR&#34;</span><span class=p>,</span> <span class=s2>&#34;CV&#34;</span><span class=p>,</span> <span class=s2>&#34;CW&#34;</span><span class=p>,</span> <span class=s2>&#34;CY&#34;</span><span class=p>,</span> <span class=s2>&#34;CZ&#34;</span><span class=p>,</span> <span class=s2>&#34;DE&#34;</span><span class=p>,</span> <span class=s2>&#34;DJ&#34;</span><span class=p>,</span> <span class=s2>&#34;DK&#34;</span><span class=p>,</span> <span class=s2>&#34;DM&#34;</span><span class=p>,</span> <span class=s2>&#34;DO&#34;</span><span class=p>,</span> <span class=s2>&#34;DZ&#34;</span><span class=p>,</span> <span class=s2>&#34;EC&#34;</span><span class=p>,</span> <span class=s2>&#34;EE&#34;</span><span class=p>,</span> <span class=s2>&#34;EG&#34;</span><span class=p>,</span> <span class=s2>&#34;ES&#34;</span><span class=p>,</span> <span class=s2>&#34;FI&#34;</span><span class=p>,</span> <span class=s2>&#34;FJ&#34;</span><span class=p>,</span> <span class=s2>&#34;FM&#34;</span><span class=p>,</span> <span class=s2>&#34;FR&#34;</span><span class=p>,</span> <span class=s2>&#34;GA&#34;</span><span class=p>,</span> <span class=s2>&#34;GB&#34;</span><span class=p>,</span> <span class=s2>&#34;GD&#34;</span><span class=p>,</span> <span class=s2>&#34;GE&#34;</span><span class=p>,</span> <span class=s2>&#34;GH&#34;</span><span class=p>,</span> <span class=s2>&#34;GM&#34;</span><span class=p>,</span> <span class=s2>&#34;GN&#34;</span><span class=p>,</span> <span class=s2>&#34;GQ&#34;</span><span class=p>,</span> <span class=s2>&#34;GR&#34;</span><span class=p>,</span> <span class=s2>&#34;GT&#34;</span><span class=p>,</span> <span class=s2>&#34;GW&#34;</span><span class=p>,</span> <span class=s2>&#34;GY&#34;</span><span class=p>,</span> <span class=s2>&#34;HK&#34;</span><span class=p>,</span> <span class=s2>&#34;HN&#34;</span><span class=p>,</span> <span class=s2>&#34;HR&#34;</span><span class=p>,</span> <span class=s2>&#34;HT&#34;</span><span class=p>,</span> <span class=s2>&#34;HU&#34;</span><span class=p>,</span> <span class=s2>&#34;ID&#34;</span><span class=p>,</span> <span class=s2>&#34;IE&#34;</span><span class=p>,</span> <span class=s2>&#34;IL&#34;</span><span class=p>,</span> <span class=s2>&#34;IN&#34;</span><span class=p>,</span> <span class=s2>&#34;IS&#34;</span><span class=p>,</span> <span class=s2>&#34;IT&#34;</span><span class=p>,</span> <span class=s2>&#34;JM&#34;</span><span class=p>,</span> <span class=s2>&#34;JO&#34;</span><span class=p>,</span> <span class=s2>&#34;JP&#34;</span><span class=p>,</span> <span class=s2>&#34;KE&#34;</span><span class=p>,</span> <span class=s2>&#34;KG&#34;</span><span class=p>,</span> <span class=s2>&#34;KH&#34;</span><span class=p>,</span> <span class=s2>&#34;KI&#34;</span><span class=p>,</span> <span class=s2>&#34;KM&#34;</span><span class=p>,</span> <span class=s2>&#34;KN&#34;</span><span class=p>,</span> <span class=s2>&#34;KR&#34;</span><span class=p>,</span> <span class=s2>&#34;KW&#34;</span><span class=p>,</span> <span class=s2>&#34;KZ&#34;</span><span class=p>,</span> <span class=s2>&#34;LA&#34;</span><span class=p>,</span> <span class=s2>&#34;LB&#34;</span><span class=p>,</span> <span class=s2>&#34;LC&#34;</span><span class=p>,</span> <span class=s2>&#34;LI&#34;</span><span class=p>,</span> <span class=s2>&#34;LK&#34;</span><span class=p>,</span> <span class=s2>&#34;LR&#34;</span><span class=p>,</span> <span class=s2>&#34;LS&#34;</span><span class=p>,</span> <span class=s2>&#34;LT&#34;</span><span class=p>,</span> <span class=s2>&#34;LU&#34;</span><span class=p>,</span> <span class=s2>&#34;LV&#34;</span><span class=p>,</span> <span class=s2>&#34;MA&#34;</span><span class=p>,</span> <span class=s2>&#34;MC&#34;</span><span class=p>,</span> <span class=s2>&#34;MD&#34;</span><span class=p>,</span> <span class=s2>&#34;ME&#34;</span><span class=p>,</span> <span class=s2>&#34;MG&#34;</span><span class=p>,</span> <span class=s2>&#34;MH&#34;</span><span class=p>,</span> <span class=s2>&#34;MK&#34;</span><span class=p>,</span> <span class=s2>&#34;ML&#34;</span><span class=p>,</span> <span class=s2>&#34;MN&#34;</span><span class=p>,</span> <span class=s2>&#34;MO&#34;</span><span class=p>,</span> <span class=s2>&#34;MR&#34;</span><span class=p>,</span> <span class=s2>&#34;MT&#34;</span><span class=p>,</span> <span class=s2>&#34;MU&#34;</span><span class=p>,</span> <span class=s2>&#34;MV&#34;</span><span class=p>,</span> <span class=s2>&#34;MW&#34;</span><span class=p>,</span> <span class=s2>&#34;MX&#34;</span><span class=p>,</span> <span class=s2>&#34;MY&#34;</span><span class=p>,</span> <span class=s2>&#34;MZ&#34;</span><span class=p>,</span> <span class=s2>&#34;NA&#34;</span><span class=p>,</span> <span class=s2>&#34;NE&#34;</span><span class=p>,</span> <span class=s2>&#34;NG&#34;</span><span class=p>,</span> <span class=s2>&#34;NI&#34;</span><span class=p>,</span> <span class=s2>&#34;NL&#34;</span><span class=p>,</span> <span class=s2>&#34;NO&#34;</span><span class=p>,</span> <span class=s2>&#34;NP&#34;</span><span class=p>,</span> <span class=s2>&#34;NR&#34;</span><span class=p>,</span> <span class=s2>&#34;NZ&#34;</span><span class=p>,</span> <span class=s2>&#34;OM&#34;</span><span class=p>,</span> <span class=s2>&#34;PA&#34;</span><span class=p>,</span> <span class=s2>&#34;PE&#34;</span><span class=p>,</span> <span class=s2>&#34;PG&#34;</span><span class=p>,</span> <span class=s2>&#34;PH&#34;</span><span class=p>,</span> <span class=s2>&#34;PK&#34;</span><span class=p>,</span> <span class=s2>&#34;PL&#34;</span><span class=p>,</span> <span class=s2>&#34;PS&#34;</span><span class=p>,</span> <span class=s2>&#34;PT&#34;</span><span class=p>,</span> <span class=s2>&#34;PW&#34;</span><span class=p>,</span> <span class=s2>&#34;PY&#34;</span><span class=p>,</span> <span class=s2>&#34;QA&#34;</span><span class=p>,</span> <span class=s2>&#34;RO&#34;</span><span class=p>,</span> <span class=s2>&#34;RS&#34;</span><span class=p>,</span> <span class=s2>&#34;RU&#34;</span><span class=p>,</span> <span class=s2>&#34;RW&#34;</span><span class=p>,</span> <span class=s2>&#34;SA&#34;</span><span class=p>,</span> <span class=s2>&#34;SB&#34;</span><span class=p>,</span> <span class=s2>&#34;SC&#34;</span><span class=p>,</span> <span class=s2>&#34;SE&#34;</span><span class=p>,</span> <span class=s2>&#34;SG&#34;</span><span class=p>,</span> <span class=s2>&#34;SI&#34;</span><span class=p>,</span> <span class=s2>&#34;SK&#34;</span><span class=p>,</span> <span class=s2>&#34;SL&#34;</span><span class=p>,</span> <span class=s2>&#34;SM&#34;</span><span class=p>,</span> <span class=s2>&#34;SN&#34;</span><span class=p>,</span> <span class=s2>&#34;SR&#34;</span><span class=p>,</span> <span class=s2>&#34;ST&#34;</span><span class=p>,</span> <span class=s2>&#34;SV&#34;</span><span class=p>,</span> <span class=s2>&#34;SZ&#34;</span><span class=p>,</span> <span class=s2>&#34;TD&#34;</span><span class=p>,</span> <span class=s2>&#34;TG&#34;</span><span class=p>,</span> <span class=s2>&#34;TH&#34;</span><span class=p>,</span> <span class=s2>&#34;TL&#34;</span><span class=p>,</span> <span class=s2>&#34;TN&#34;</span><span class=p>,</span> <span class=s2>&#34;TO&#34;</span><span class=p>,</span> <span class=s2>&#34;TR&#34;</span><span class=p>,</span> <span class=s2>&#34;TT&#34;</span><span class=p>,</span> <span class=s2>&#34;TV&#34;</span><span class=p>,</span> <span class=s2>&#34;TW&#34;</span><span class=p>,</span> <span class=s2>&#34;TZ&#34;</span><span class=p>,</span> <span class=s2>&#34;UA&#34;</span><span class=p>,</span> <span class=s2>&#34;UG&#34;</span><span class=p>,</span> <span class=s2>&#34;US&#34;</span><span class=p>,</span> <span class=s2>&#34;UY&#34;</span><span class=p>,</span> <span class=s2>&#34;UZ&#34;</span><span class=p>,</span> <span class=s2>&#34;VC&#34;</span><span class=p>,</span> <span class=s2>&#34;VN&#34;</span><span class=p>,</span> <span class=s2>&#34;VU&#34;</span><span class=p>,</span> <span class=s2>&#34;WS&#34;</span><span class=p>,</span> <span class=s2>&#34;XK&#34;</span><span class=p>,</span> <span class=s2>&#34;ZA&#34;</span><span class=p>,</span> <span class=s2>&#34;ZM&#34;</span><span class=p>,</span> <span class=s2>&#34;ZW&#34;</span> <span class=p>],</span>
      <span class=nt>&#34;disc_number&#34;</span> <span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
      <span class=nt>&#34;duration_ms&#34;</span> <span class=p>:</span> <span class=mi>201467</span><span class=p>,</span>
      <span class=nt>&#34;explicit&#34;</span> <span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
      <span class=nt>&#34;external_ids&#34;</span> <span class=p>:</span> <span class=p>{</span>
        <span class=nt>&#34;isrc&#34;</span> <span class=p>:</span> <span class=s2>&#34;DEGA22003204&#34;</span>
      <span class=p>},</span>
      <span class=nt>&#34;external_urls&#34;</span> <span class=p>:</span> <span class=p>{</span>
        <span class=nt>&#34;spotify&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://open.spotify.com/track/1ChzNnL5BTDCDYQHxrT1l9&#34;</span>
      <span class=p>},</span>
      <span class=nt>&#34;href&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://api.spotify.com/v1/tracks/1ChzNnL5BTDCDYQHxrT1l9&#34;</span><span class=p>,</span>
      <span class=nt>&#34;id&#34;</span> <span class=p>:</span> <span class=s2>&#34;1ChzNnL5BTDCDYQHxrT1l9&#34;</span><span class=p>,</span>
      <span class=nt>&#34;is_local&#34;</span> <span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
      <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=s2>&#34;Can&#39;t Sleep - Radio Version&#34;</span><span class=p>,</span>
      <span class=nt>&#34;popularity&#34;</span> <span class=p>:</span> <span class=mi>60</span><span class=p>,</span>
      <span class=nt>&#34;preview_url&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://p.scdn.co/mp3-preview/7054cfd91e1804006c4bef0bc72df517a8794a42?cid=774b29d4f13844c495f206cafdad9c86&#34;</span><span class=p>,</span>
      <span class=nt>&#34;track_number&#34;</span> <span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
      <span class=nt>&#34;type&#34;</span> <span class=p>:</span> <span class=s2>&#34;track&#34;</span><span class=p>,</span>
      <span class=nt>&#34;uri&#34;</span> <span class=p>:</span> <span class=s2>&#34;spotify:track:1ChzNnL5BTDCDYQHxrT1l9&#34;</span>
    <span class=p>},</span>
    <span class=nt>&#34;played_at&#34;</span> <span class=p>:</span> <span class=s2>&#34;2021-04-26T12:58:27.757Z&#34;</span><span class=p>,</span>
    <span class=nt>&#34;context&#34;</span> <span class=p>:</span> <span class=kc>null</span>
  <span class=p>}</span> <span class=p>],</span>
  <span class=nt>&#34;next&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://api.spotify.com/v1/me/player/recently-played?before=1619441907757&amp;limit=1&#34;</span><span class=p>,</span>
  <span class=nt>&#34;cursors&#34;</span> <span class=p>:</span> <span class=p>{</span>
    <span class=nt>&#34;after&#34;</span> <span class=p>:</span> <span class=s2>&#34;1619441907757&#34;</span><span class=p>,</span>
    <span class=nt>&#34;before&#34;</span> <span class=p>:</span> <span class=s2>&#34;1619441907757&#34;</span>
  <span class=p>},</span>
  <span class=nt>&#34;limit&#34;</span> <span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
  <span class=nt>&#34;href&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://api.spotify.com/v1/me/player/recently-played?limit=1&#34;</span>

</code></pre></div><p>adesso siamo pronti a usare i dizionari e pandas con i <a href=https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html target=_blank rel="noopener noreferrer">DataFrame</a></p><p>quindi cataloghiamo i nostri dati dal json:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>data</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
<span class=n>song_names</span> <span class=o>=</span> <span class=p>[]</span>
<span class=n>artist_names</span> <span class=o>=</span> <span class=p>[]</span>
<span class=n>played_at_list</span> <span class=o>=</span> <span class=p>[]</span>
<span class=n>timestamps</span> <span class=o>=</span> <span class=p>[]</span>
<span class=k>print</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
<span class=k>for</span> <span class=n>song</span> <span class=ow>in</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>]:</span>
    <span class=k>print</span><span class=p>(</span><span class=n>song</span><span class=p>[</span><span class=s2>&#34;track&#34;</span><span class=p>][</span><span class=s2>&#34;name&#34;</span><span class=p>])</span>
    <span class=n>song_names</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>song</span><span class=p>[</span><span class=s2>&#34;track&#34;</span><span class=p>][</span><span class=s2>&#34;name&#34;</span><span class=p>])</span>
    <span class=n>artist_names</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>song</span><span class=p>[</span><span class=s2>&#34;track&#34;</span><span class=p>][</span><span class=s2>&#34;album&#34;</span><span class=p>][</span><span class=s2>&#34;artists&#34;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s2>&#34;name&#34;</span><span class=p>])</span>
    <span class=n>played_at_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>song</span><span class=p>[</span><span class=s2>&#34;played_at&#34;</span><span class=p>])</span>
    <span class=n>timestamps</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>song</span><span class=p>[</span><span class=s2>&#34;played_at&#34;</span><span class=p>][</span><span class=mi>0</span><span class=p>:</span><span class=mi>10</span><span class=p>])</span>

<span class=n>song_dict</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s2>&#34;song_name&#34;</span> <span class=p>:</span> <span class=n>song_names</span><span class=p>,</span>
    <span class=s2>&#34;artist_name&#34;</span><span class=p>:</span> <span class=n>artist_names</span><span class=p>,</span>
    <span class=s2>&#34;played_at&#34;</span><span class=p>:</span> <span class=n>played_at_list</span><span class=p>,</span>
    <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>timestamps</span>
<span class=p>}</span>
<span class=n>song_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>song_dict</span><span class=p>,</span> <span class=n>columns</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;song_name&#34;</span><span class=p>,</span><span class=s2>&#34;artist_name&#34;</span><span class=p>,</span><span class=s2>&#34;played_at&#34;</span><span class=p>,</span><span class=s2>&#34;timestamp&#34;</span><span class=p>]</span> <span class=p>)</span>

<span class=k>print</span><span class=p>(</span><span class=n>song_df</span><span class=p>)</span>
<span class=c1>#Validate</span>
<span class=k>if</span> <span class=n>check_if_valid_data</span><span class=p>(</span><span class=n>song_df</span><span class=p>):</span>
    <span class=k>print</span><span class=p>(</span><span class=s2>&#34;Data valid, proceed to Load stage&#34;</span><span class=p>)</span>
</code></pre></div><p>analizziamo il codice:</p><h3 id=creiamo-prima-degli-array-che-rappresentano>Creiamo prima degli array che rappresentano:</h3><ol><li>song_names (nomi delle canzoni)</li><li>artist_names (nome degli artisti)</li><li>plated_at_list (lista riprodotta)</li><li>timestamps (tempo nel quale è stato riprodotto il brano)</li></ol><div class=highlight><pre class=chroma><code class=language-python data-lang=python>
<span class=k>for</span> <span class=n>song</span> <span class=ow>in</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;items&#34;</span><span class=p>]:</span>
    <span class=k>print</span><span class=p>(</span><span class=n>song</span><span class=p>[</span><span class=s2>&#34;track&#34;</span><span class=p>][</span><span class=s2>&#34;name&#34;</span><span class=p>])</span>
    <span class=n>song_names</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>song</span><span class=p>[</span><span class=s2>&#34;track&#34;</span><span class=p>][</span><span class=s2>&#34;name&#34;</span><span class=p>])</span>
    <span class=n>artist_names</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>song</span><span class=p>[</span><span class=s2>&#34;track&#34;</span><span class=p>][</span><span class=s2>&#34;album&#34;</span><span class=p>][</span><span class=s2>&#34;artists&#34;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s2>&#34;name&#34;</span><span class=p>])</span>
    <span class=n>played_at_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>song</span><span class=p>[</span><span class=s2>&#34;played_at&#34;</span><span class=p>])</span>
    <span class=n>timestamps</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>song</span><span class=p>[</span><span class=s2>&#34;played_at&#34;</span><span class=p>][</span><span class=mi>0</span><span class=p>:</span><span class=mi>10</span><span class=p>])</span>
</code></pre></div><p>tutti i contenuti sono dentro items quindi ci posizioniamo li e lo scorriamo e aggiungiamo a ogni array le relative informazioni</p><h3 id=creiamo-un-dizionario-in-python>Creiamo un dizionario in python</h3><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>song_dict</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s2>&#34;song_name&#34;</span> <span class=p>:</span> <span class=n>song_names</span><span class=p>,</span>
    <span class=s2>&#34;artist_name&#34;</span><span class=p>:</span> <span class=n>artist_names</span><span class=p>,</span>
    <span class=s2>&#34;played_at&#34;</span><span class=p>:</span> <span class=n>played_at_list</span><span class=p>,</span>
    <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>timestamps</span>
<span class=p>}</span>
</code></pre></div><h3 id=creiamo-un-dataframe-rappresentabile-con-pandas>Creiamo un DataFrame rappresentabile con pandas</h3><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>song_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>song_dict</span><span class=p>,</span> <span class=n>columns</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;song_name&#34;</span><span class=p>,</span><span class=s2>&#34;artist_name&#34;</span><span class=p>,</span><span class=s2>&#34;played_at&#34;</span><span class=p>,</span><span class=s2>&#34;timestamp&#34;</span><span class=p>]</span> <span class=p>)</span>
</code></pre></div><p>Pandas è una libreria che permette la manipolazione dei dati e la rappresentazione tramite dei DataFrame e non solo.</p><p>I parametri da passare a pandas saranno i dizionari e le colonne da rappresentare.</p><p>esempio di output:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>print</span><span class=p>(</span><span class=n>song_df</span><span class=p>)</span>
</code></pre></div><pre><code>                song_name  artist_name                 played_at   timestamp
0                 Ride It       Regard  2021-04-15T14:19:54.032Z  2021-04-15
1                 Be Mine     Ofenbach  2021-04-15T14:16:14.467Z  2021-04-15
2   Roses - Imanbek Remix    SAINt JHN  2021-04-15T14:13:32.656Z  2021-04-15
3                 Ride It       Regard  2021-04-15T14:10:35.325Z  2021-04-15
4                 Ride It       Regard  2021-04-14T12:14:36.069Z  2021-04-14
5                 Ride It       Regard  2021-04-14T12:10:56.966Z  2021-04-14
6   Roses - Imanbek Remix    SAINt JHN  2021-04-14T12:06:49.074Z  2021-04-14
7                 Ride It       Regard  2021-04-14T12:03:51.746Z  2021-04-14
8                 Be Mine     Ofenbach  2021-04-14T08:07:25.552Z  2021-04-14
9   Roses - Imanbek Remix    SAINt JHN  2021-04-14T07:32:04.034Z  2021-04-14
10                Ride It       Regard  2021-04-14T07:28:30.376Z  2021-04-14
11    Che Ne Sanno I 2000  Gabry Ponte  2021-04-14T07:23:34.461Z  2021-04-14
12                Be Mine     Ofenbach  2021-04-14T07:19:39.603Z  2021-04-14
13  Roses - Imanbek Remix    SAINt JHN  2021-04-14T07:16:57.939Z  2021-04-14
14                Ride It       Regard  2021-04-14T07:13:40.048Z  2021-04-14
15  Roses - Imanbek Remix    SAINt JHN  2021-04-13T17:58:10.820Z  2021-04-13
16                Ride It       Regard  2021-04-13T12:37:49.168Z  2021-04-13
17  Roses - Imanbek Remix    SAINt JHN  2021-04-13T12:34:04.503Z  2021-04-13
18                Ride It       Regard  2021-04-13T12:31:07.186Z  2021-04-13
19                Ride It       Regard      2021-04-13T12:27:54Z  2021-04-13
</code></pre><h2 id=validazione>Validazione</h2><p>Usiamo un semplice if per validare i dati in modo che non sia null.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1>#Validate</span>
    <span class=k>if</span> <span class=n>check_if_valid_data</span><span class=p>(</span><span class=n>song_df</span><span class=p>):</span>
        <span class=k>print</span><span class=p>(</span><span class=s2>&#34;Data valid, proceed to Load stage&#34;</span><span class=p>)</span>
</code></pre></div><h2 id=load>Load</h2><p>Adesso carichiamo i dati su un db locale tipo SQLite3:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python>    <span class=n>engine</span> <span class=o>=</span> <span class=n>sqlalchemy</span><span class=o>.</span><span class=n>create_engine</span><span class=p>(</span><span class=n>DATABASE_LOCATION</span><span class=p>)</span>
    <span class=n>conn</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s1>&#39;my_played_tracks.sqlite&#39;</span><span class=p>)</span>
    <span class=n>cursor</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>

    <span class=n>sql_query</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span><span class=s2>    CREATE TABLE IF NOT EXISTS my_played_tracks(
</span><span class=s2>        song_name VARCHAR(200),
</span><span class=s2>        artist_name VARCHAR(200),
</span><span class=s2>        played_at VARCHAR(200),
</span><span class=s2>        timestamp VARCHAR(200),
</span><span class=s2>        CONSTRAINT primary_key_constraint PRIMARY KEY (played_at)
</span><span class=s2>    ) &#34;&#34;&#34;</span>

    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>sql_query</span><span class=p>)</span>
    <span class=k>print</span><span class=p>(</span><span class=s2>&#34;Opened database succesfully&#34;</span><span class=p>)</span>

    <span class=k>try</span><span class=p>:</span>
        <span class=n>song_df</span><span class=o>.</span><span class=n>to_sql</span><span class=p>(</span><span class=s2>&#34;my_played_tracks&#34;</span><span class=p>,</span> <span class=n>engine</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=bp>False</span><span class=p>,</span> <span class=n>if_exists</span><span class=o>=</span><span class=s1>&#39;append&#39;</span><span class=p>)</span>
    <span class=k>except</span><span class=p>:</span>
        <span class=k>print</span><span class=p>(</span><span class=s2>&#34;Data alredy exists in the database&#34;</span><span class=p>)</span>

    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>

    <span class=k>print</span><span class=p>(</span><span class=s2>&#34;Close database successfully&#34;</span><span class=p>)</span>
</code></pre></div><h3 id=analizziamo-il-codice-della-load>Analizziamo il codice della load</h3><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>engine</span> <span class=o>=</span> <span class=n>sqlalchemy</span><span class=o>.</span><span class=n>create_engine</span><span class=p>(</span><span class=n>DATABASE_LOCATION</span><span class=p>)</span>
</code></pre></div><p>questo effettuerà la chiamata al motore sqllite della libreria sqlalchemy e come parametro gli verrà passato la destinazione di dove verrà salvato il file.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>conn</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s1>&#39;my_played_tracks.sqlite&#39;</span><span class=p>)</span>
    <span class=n>cursor</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</code></pre></div><p>mi connetto al mio database con il primo comando mentre con il secondo preparo il [cursore](<a href=https://it.wikipedia.org/wiki/Cursore_(basi_di_dati)>https://it.wikipedia.org/wiki/Cursore_(basi_di_dati)</a></p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>try</span><span class=p>:</span>
        <span class=n>song_df</span><span class=o>.</span><span class=n>to_sql</span><span class=p>(</span><span class=s2>&#34;my_played_tracks&#34;</span><span class=p>,</span> <span class=n>engine</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=bp>False</span><span class=p>,</span> <span class=n>if_exists</span><span class=o>=</span><span class=s1>&#39;append&#39;</span><span class=p>)</span>
    <span class=k>except</span><span class=p>:</span>
        <span class=k>print</span><span class=p>(</span><span class=s2>&#34;Data alredy exists in the database&#34;</span><span class=p>)</span>
</code></pre></div><p>qui cosa facciamo tramite un <a href=https://www.w3schools.com/python/python_try_except.asp target=_blank rel="noopener noreferrer">try catch</a>
effettuiamo un inserimento del nostro datafram direttamente in sql pandas ci da l&rsquo;opportunità di trasformare il nostro codice in sql e poi passandogli anche l&rsquo;engine come parametro scrive direttamente sul db.</p><h2 id=conclusioni>Conclusioni</h2><p>Adesso avete tutte le caratteristiche per far in modo che un set di dati da spotify possiate salvarlo su un db e quindi tramite un cronjob o altri strumenti di cui parlaremo in altro post eseguire lo script in modo continuo.</p></article><section class="article labels"><a class=category href=/categories/python/>Python</a><a class=tag href=/tags/python/>Python</a><a class=tag href=/tags/spotify/>Spotify</a><a class=tag href=/tags/etl/>Etl</a></section><section class="article author"><img class=avatar src="https://secure.gravatar.com/avatar/a34726467b82c334a63b6ec750049e6c?size=200" alt><p class=name>Giacomo Lorenzo</p><div class=bio>La mia passione più grande è provare delle cose nuove.</div><div class=details><a class=item href=https://github.com/myGithub target=_blank rel="noopener noreferrer"><span class="iconfont icon-github"></span>&nbsp;myGithub</a><a class=item href=https://twitter.com/myTwitter target=_blank rel="noopener noreferrer"><span class="iconfont icon-twitter"></span>&nbsp;@myTwitter</a></div></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/post/perche-ho-scelto-hugo/><span class="iconfont icon-article"></span>Perchè ho Scelto Hugo</a></p></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>©2020 Notepadium.</p><p class=powerby><span>Powered&nbsp;by&nbsp;</span><a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a><span>&nbsp;&&nbsp;</span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank rel="noopener noreferrer">Notepadium</a>
<a href="https://ipv6-test.com/validate.php?url=referer"><img src=https://ipv6-test.com/button-ipv6-80x15.png alt="ipv6 ready" title="ipv6 ready" border=0></a></p></div></section></body></html>